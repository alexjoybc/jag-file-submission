version: "3.7"
services:
  #############################################################################################
  ###                                 EFILING FRONTEND                                      ###
  #############################################################################################
  # efiling-frontend:
  #   container_name: efiling-frontend
  #   build:
  #     context: ./src/frontend/efiling-frontend
  #   ports:
  #     - 3000:8080
  #   environment:
  #     - REACT_APP_KEYCLOAK_REALM=${KEYCLOAK_REALM:-Efiling-Hub}
  #     - REACT_APP_KEYCLOAK_CLIENT_ID=efiling-frontend
  #     - REACT_APP_KEYCLOAK_URL=${KEYCLOAK_URL:-http://localhost:8081/auth}
  #     - REACT_APP_API_BASE_URL=http://localhost:8080
  #     - REACT_APP_BAMBORA_REDIRECT_URL=http://localhost:3000/efilinghub

  #############################################################################################
  ###                                 EFILING DEMO                                          ###
  #############################################################################################
  # efiling-demo:
  #   container_name: efiling-demo
  #   build:
  #     context: ./src/frontend/efiling-demo
  #   environment:
  #     - REACT_APP_KEYCLOAK_REALM=Efiling-Hub
  #     - REACT_APP_KEYCLOAK_CLIENT_ID=efiling-admin
  #     - REACT_APP_KEYCLOAK_URL=http://localhost:8081/auth
  #     - REACT_APP_API_BASE_URL=http://localhost:8080
  #     - REACT_APP_BAMBORA_REDIRECT_URL=http://localhost:3000/efilinghub
  #   ports:
  #     - 3001:8080

  #############################################################################################
  ###                           Efiling api backend app                                     ###
  #############################################################################################
  efiling-api:
    image: docker.pkg.github.com/bcgov/jag-file-submission/efiling-api:demo
    container_name: efiling-api
    hostname: efiling-api
    ports:
      - "8080:8080"
    environment:
      - BAMBORA_APIPASSCODE=passcode
      - BAMBORA_MERCHANTID=merchantid
      - BAMBORA_PROFILE_URL=http://localhost:3001/updatecard
      - BAMBORA_HASHKEY=key
      - BAMBORA_URL_EXPIRY=10

      - KEYCLOAK_AUTH_SERVER_URL=http://keycloak:8080/auth
      - KEYCLOAK_REALM=Efiling-Hub
      - KEYCLOAK_CREDENTIALS_SECRET=abc
      - KEYCLOAK_SSL_REQUIRED=-none

      - REDIS_HOST=redis
      - REDIS_PORT=6379
      - REDIS_PASSWORD=admin

      - NAVIGATION_BASE_URL=http://localhost:3000/efilinghub
      - NAVIGATION_EXPIRYTIME=10

      - CLAMAV_HOST=clamav
      - CLAMAV_TIMEOUT=150000

      - SFTP_KNOWNHOSTS=${SFTP_KNOWNHOSTS}
      - SFTP_REMOTELOCATION=${SFTP_REMOTELOCATION}
      - SFTP_PRIVATE_KEY=${SFTP_PRIVATE_KEY}

    networks:
      - fisu-net

  # #############################################################################################
  # ###                                        KEYCLOAK Config                                ###
  # #############################################################################################
  # keycloak-config:
  #   build:
  #     context: ./infrastructure/keycloak
  #     args:
  #       - KEYCLOAK_URL=http://keycloak:8080
  #   command: sh -c "dockerize -wait http://keycloak:8080 -timeout 300s /tmp/createuser.sh"
  #   networks:
  #     - fisu-net
